
# payment-service
Бот для платежей с использованием Yookassa и Telegram

### Предварительные требования

- Установленный Docker на вашем компьютере.
- Python версии 3.8 или выше.
- PyCharm Professional Edition (рекомендуется для управления базой данных).
- Установленный Ngrok для экспонирования локального сервера в интернет.

### Инструкции по настройке

Запустите Docker: В папке docker выполните команду для поднятия контейнеров.
Настройка базы данных: Используйте PyCharm для подключения к PostgreSQL и выполните скрипт из migrations/init.sql для инициализации базы данных.
Создание туннеля с Ngrok:
Установите Ngrok, если он еще не установлен.
Запустите команду в терминале: ngrok http 8000 (или порт вашего приложения). Скопируйте предоставленный URL.
Настройка Yookassa: Войдите в Yookassa и настройте HTTP-уведомления с URL, полученным от Ngrok.
Запуск приложения: Запустите ваше приложение с помощью Uvicorn.
Взаимодействие с Telegram: Найдите бота @paymenttestpythonbot, отправьте команду /start и получите ваш chat_id. Сохраните его в таблице users базы данных.
## Методы сервиса

### Создание платежа

**Метод**: POST  
**URL**: `http://localhost:8000/payment/make`  
**Content-Type**: `application/json`

**Описание**: Этот метод используется для создания нового платежа. Необходимо передать идентификатор инициатора платежа и список продуктов с их идентификаторами и количеством.

**Пример запроса**:
```json
{
  "initiator_id": 1,
  "products": [
    {
      "product_id": 1,
      "amount": 2
    },
    {
      "product_id": 2,
      "amount": 5
    }
  ]
}
```

### Возврат платежа

**Метод**: POST  
**URL**: `http://localhost:8000/payment/refund`  
**Content-Type**: `application/json`

**Описание**: Этот метод используется для возврата ранее совершенного платежа. Необходимо передать идентификатор платежа, который вы хотите вернуть.

**Пример запроса**:
```json
{
  "payment_id": ""
}
```

## Структура кода

### Сервис платежей

Основная функциональность для работы с платежами находится в файле `app/services/yookassa/payment_service.py`. Этот сервис взаимодействует с API Yookassa для управления платежами.

### Сервис Telegram

Взаимодействие с ботом Telegram обрабатывается в файле `app/services/telegram/telegram_service.py`. Этот сервис управляет коммуникацией с пользователями и отправкой уведомлений.

### Эндпоинты API

Эндпоинты для управления платежами определены в файле `app/presentation/rest/payment/payment_router.py`. Эти эндпоинты позволяют создавать платежи, запрашивать информацию о них, а также обрабатывать успешные и отмененные платежи.
